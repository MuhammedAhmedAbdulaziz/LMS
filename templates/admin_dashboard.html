{% extends "layout.html" %}

{% block content %}
<h1>Admin Dashboard</h1>

<div class="admin-grid">
    <!-- Manage Books Section -->
    <div class="card full-width">
        <h2>Manage Books</h2>
        <div class="admin-actions">
            <div class="action-form">
                <h3>Add New Book</h3>
                <form action="{{ url_for('add_book') }}" method="post">
                    <input type="text" name="title" placeholder="Title" required>
                    <input type="text" name="author" placeholder="Author" required>
                    <input type="text" name="category" placeholder="Category" required>
                    <button type="submit" class="btn">Add Book</button>
                </form>
            </div>
            <div class="action-form">
                <h3>Update Book</h3>
                <form action="{{ url_for('update_book') }}" method="post">
                    <input type="number" name="book_id" placeholder="Book ID" required>
                    <select name="field" required>
                        <option value="title">Title</option>
                        <option value="author">Author</option>
                        <option value="category">Category</option>
                    </select>
                    <input type="text" name="new_value" placeholder="New Value" required>
                    <button type="submit" class="btn">Update</button>
                </form>
            </div>
            <div class="action-form">
                <h3>Delete Book</h3>
                <form action="{{ url_for('delete_book') }}" method="post" onsubmit="return confirm('Are you sure you want to delete this book?');">
                    <input type="number" name="book_id" placeholder="Book ID" required>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>

        <h3>All Books in Library</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>ID</th><th>Title</th><th>Author</th><th>Category</th><th>Status</th></tr>
                </thead>
                <tbody>
                    {% for book in all_books %}
                    <tr>
                        <td>{{ book.id }}</td>
                        <td>{{ book.title }}</td>
                        <td>{{ book.author }}</td>
                        <td>{{ book.category }}</td>
                        <td>
                            {% if book.status == 'available' %}
                                <span class="status-available">{{ book.status }}</span>
                            {% else %}
                                <span class="status-borrowed">{{ book.status }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Manage Users Section -->
     <div class="card">
        <h2>Manage Users</h2>
        <div class="action-form">
            <h3>Create New Account</h3>
            <form action="{{ url_for('create_user') }}" method="post">
                <input type="text" name="username" placeholder="Username" required>
                <input type="password" name="password" placeholder="Password" required>
                <select name="role" required>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
                <button type="submit" class="btn">Create User</button>
            </form>
        </div>
    </div>

    <!-- View Transactions Section -->
    <div class="card">
        <h2>All Transactions</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>User</th><th>Book Title</th><th>Borrowed</th><th>Due</th><th>Returned</th></tr>
                </thead>
                <tbody>
                    {% for t in transactions %}
                    <tr>
                        <td>{{ t.username }}</td>
                        <td>{{ t.title }}</td>
                        <td>{{ t.borrow_date.split(' ')[0] }}</td>
                        <td>{{ t.due_date.split(' ')[0] }}</td>
                        <td>{{ t.return_date.split(' ')[0] if t.return_date else 'Not Returned' }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5">No transactions found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}