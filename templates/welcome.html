{% extends "layout.html" %}

{% block content %}
<div class="welcome-container">
    <div class="form-card" id="auth-card">
        <h2 id="form-title">Login</h2>
        <form id="auth-form" action="{{ url_for('login') }}" method="post">
            
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required>
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
            </div>
            
            <!-- This field is hidden by default and only shown for Sign Up -->
            <div class="form-group hidden" id="confirm-password-group">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" id="confirm_password" name="confirm_password">
            </div>
            
            <button type="submit" class="btn btn-primary btn-full" id="submit-button">Login</button>
        </form>
        
        <p class="form-toggle">
            <span id="toggle-text">Don't have an account?</span>
            <a href="#" id="toggle-link">Sign Up</a>
        </p>
    </div>
</div>

<script>
    // Get all the elements we need to change
    const toggleLink = document.getElementById('toggle-link');
    const formTitle = document.getElementById('form-title');
    const authForm = document.getElementById('auth-form');
    const submitButton = document.getElementById('submit-button');
    const confirmPasswordGroup = document.getElementById('confirm-password-group');
    const confirmPasswordInput = document.getElementById('confirm_password');
    const toggleText = document.getElementById('toggle-text');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');

    let isLogin = true;

    // Listen for a click on the toggle link
    toggleLink.addEventListener('click', (e) => {
        e.preventDefault(); // Prevent the link from navigating
        isLogin = !isLogin; // Flip the state

        // Clear input fields on switch
        usernameInput.value = '';
        passwordInput.value = '';
        confirmPasswordInput.value = '';

        if (isLogin) {
            // --- Switch to LOGIN mode ---
            formTitle.innerText = 'Login';
            authForm.action = "{{ url_for('login') }}";
            submitButton.innerText = 'Login';
            confirmPasswordGroup.classList.add('hidden'); // Hide confirm password
            confirmPasswordInput.required = false;
            toggleText.innerText = "Don't have an account?";
            toggleLink.innerText = 'Sign Up';
        } else {
            // --- Switch to SIGN UP mode ---
            formTitle.innerText = 'Sign Up';
            authForm.action = "{{ url_for('signup') }}";
            submitButton.innerText = 'Sign Up';
            confirmPasswordGroup.classList.remove('hidden'); // Show confirm password
            confirmPasswordInput.required = true;
            toggleText.innerText = 'Already have an account?';
            toggleLink.innerText = 'Login';
        }
    });

    // Add a simple client-side check for password matching before submitting the form
    authForm.addEventListener('submit', (e) => {
        if (!isLogin) { // Only run this check in Sign Up mode
            if (passwordInput.value !== confirmPasswordInput.value) {
                e.preventDefault(); // Stop the form from submitting
                alert('Passwords do not match. Please try again.');
            }
        }
    });
</script>
{% endblock %}